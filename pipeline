def suma(num1, num2)
{
    return num1+num2
}

pipeline
{
    agent any
    options
    {
        timeout(time:10, unit: 'MINUTES')
    }
    
    environment
    {
        directory = "C:\\ProgramData\\Jenkins\\.jenkins\\workspace\\Ejemplo_13\\Proyecto\\"
    }
    
    tools
    {
        maven 'Maven'
    }
    
    stages
    {
        stage("Operacion aritmetica")
        {
            steps
            {
                script
                {
                    def resultado = suma(5,10)
                    println "El resultado de la suma es: ${resultado}"
                }
            }
        }
        
        
        stage('Clonar el repositorio')
        {
            steps
            {
                git branch: 'desarrollo', url: "https://github.com/Ripper2021/Jenkins-Friends.git"
            }
        }
        
        stage("MVN Test")
        {
            steps
            {
                script
                {
                    dir(directory)
                    {
                        bat 'mvn test'
                    }
                }
            }
        }
        
        stage("MVN Clean")
        {
            steps
            {
                script
                {
                    dir(directory)
                    {
                        bat 'mvn clean'
                    }
                }
            }
        }
        
        stage("MVN Install")
        {
            steps
            {
                script
                {
                    dir(directory)
                    {
                        bat 'mvn install'
                    }
                }
            }
        }
        
        stage("Copio el archivo")
        {
            steps
            {
                script
                {
                    bat 'cmd /c xcopy "C:\\ProgramData\\Jenkins\\.jenkins\\workspace\\Ejemplo_13\\target\\miproyecto-0.0.1-SNAPSHOT.jar" "C:\\" /y'
                }
                
            }
        }
        
    }
    
post
{
    always
    {
       script
       {
         def time = new Date()
        echo 'El pipeline se ejecuto '  +time
       }
    }
    
    success
    {
        echo 'Se ejecuto de forma correcta'
    }
    
    failure
    {
        echo 'El pipeline fallo'
        mail to: 'soporte@inetum.com', subject: "Pipeline fallo", body: "El pipeline no se ejecuto"
    }
}
}
